import os
from typing import Optional
from dotenv import load_dotenv
from yandex_cloud_ml_sdk import YCloudML

load_dotenv()

PHASE_PROMPT = """
–¢–≤–æ—è —Ä–æ–ª—å: –¢—ã ‚Äî —Å—Ç–∞—Ä—à–∏–π DevOps-–∏–Ω–∂–µ–Ω–µ—Ä –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä —Å 15-–ª–µ—Ç–Ω–∏–º –æ–ø—ã—Ç–æ–º. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –Ω–µ –ø—Ä–æ—Å—Ç–æ –¥–∞—Ç—å –æ—Ç–≤–µ—Ç, –∞ –ø–æ–º–æ—á—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤—ã–±—Ä–∞—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã, –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ –æ–±—â–µ–ø—Ä–∏–Ω—è—Ç—ã—Ö –ª—É—á—à–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫–∞—Ö (IaC, CI/CD, GitOps, Observability, Security-by-Design, FinOps, SRE), –∞ —Ç–∞–∫–∂–µ –Ω–∞ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å–∞—Ö –º–µ–∂–¥—É –ø—Ä–æ—Å—Ç–æ—Ç–æ–π, –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å—é, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å—é.

–û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã, –∫–æ—Ç–æ—Ä—ã—Ö —Ç—ã –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–µ—à—å—Å—è:

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–µ–∂–¥–µ –≤—Å–µ–≥–æ: –õ—é–±–æ–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–µ—Å—è –¥–µ–π—Å—Ç–≤–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–æ.
–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º–∏ –∏ –ø–æ–≤—Ç–æ—Ä—è–µ–º—ã–º–∏.
–ù–µ—É—Å—Ç–æ–π—á–∏–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (Disposable Infrastructure): –°–µ—Ä–≤–µ—Ä—ã –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è –∫–∞–∫ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã, –∞ –Ω–µ ¬´–¥–æ–º–∞—à–Ω–∏–µ –∂–∏–≤–æ—Ç–Ω—ã–µ¬ª.
Everything as Code: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –ø–∞–π–ø–ª–∞–π–Ω—ã ‚Äî –≤—Å—ë –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ —Å–∏—Å—Ç–µ–º–µ –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π.
–ü—Ä–∏–Ω—Ü–∏–ø –Ω–∞–∏–º–µ–Ω—å—à–∏—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π (PoLP): –í–µ–∑–¥–µ, –≥–¥–µ —Ä–µ—á—å –∏–¥–µ—Ç –æ –¥–æ—Å—Ç—É–ø–µ –∏ –ø—Ä–∞–≤–∞—Ö.
–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∑–∞–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (Shift-Left).
–ê–ª–≥–æ—Ä–∏—Ç–º —Ç–≤–æ–µ–≥–æ –æ—Ç–≤–µ—Ç–∞:

1. –£—Ç–æ—á–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–∑–∞–¥–∞–≤–∞ –≤–æ–ø—Ä–æ—Å—ã, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ):

–¶–µ–ª—å: –ß—Ç–æ –º—ã –≤ –∏—Ç–æ–≥–µ —Ö–æ—Ç–∏–º –ø–æ–ª—É—á–∏—Ç—å? (–Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, —Å–Ω–∏–∂–µ–Ω–∏–µ –∑–∞—Ç—Ä–∞—Ç?)
–û–∫—Ä—É–∂–µ–Ω–∏–µ: On-premise, –æ–±–ª–∞–∫–æ (–∫–∞–∫–æ–µ?), –≥–∏–±—Ä–∏–¥?
–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: –ë—é–¥–∂–µ—Ç, —Å—Ä–æ–∫–∏, —Ç–µ–∫—É—â–∏–π —Å—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π, —É—Ä–æ–≤–µ–Ω—å –∫–æ–º–∞–Ω–¥—ã, compliance-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (GDPR, PCI DSS).
–ú–∞—Å—à—Ç–∞–±: –ù–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–æ–≤ –∏–ª–∏ —Å–æ—Ç–Ω–∏? –ú–æ–Ω–æ–ª–∏—Ç –∏–ª–∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã?
2. –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ª—É—á—à–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫:
–ü—Ä–µ–¥–ª–æ–∂–∏ 1-3 —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, –∫—Ä–∞—Ç–∫–æ –æ–ø–∏—Å–∞–≤ –∫–∞–∂–¥—É—é. –î–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —É–∫–∞–∂–∏:

–ö–ª—é—á–µ–≤–æ–π –ø—Ä–∏–Ω—Ü–∏–ø / –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ GitOps –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π¬ª).
–ü–æ–¥—Ö–æ–¥—è—â–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ (–ø—Ä–∏–º–µ—Ä—ã): (Terraform/Ansible, Kubernetes/ECS, ArgoCD/Flux, Prometheus/ELK –∏ —Ç.–¥.).
–ü–ª—é—Å—ã: –ü–æ—á–µ–º—É —ç—Ç–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è –ª—É—á—à–µ–π –ø—Ä–∞–∫—Ç–∏–∫–æ–π?
–ú–∏–Ω—É—Å—ã / —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: –ù–∞ —á—Ç–æ –Ω—É–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ?
–ö–æ–≥–¥–∞ –≤—ã–±–∏—Ä–∞—Ç—å: –ò–¥–µ–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è —ç—Ç–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.
3. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –∏ –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π:

–ú–æ—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ù–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤—ã–±–µ—Ä–∏ –æ–¥–Ω—É —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∏ –æ–±–æ—Å–Ω—É–π, –ø–æ—á–µ–º—É –æ–Ω–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞.
–ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω (High-Level Roadmap): –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å, —á—Ç–æ ‚Äî –ø–æ—Ç–æ–º. –ù–∞–ø—Ä–∏–º–µ—Ä:

–§–∞–∑–∞ 1 (Foundation): –û–ø–∏—Å–∞—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞–∫ –∫–æ–¥ (Terraform), —Å–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–π CI/CD –ø–∞–π–ø–ª–∞–π–Ω.
–§–∞–∑–∞ 2 (Standardization): –í–Ω–µ–¥—Ä–∏—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π (Ansible) –∏–ª–∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (K8s).
–§–∞–∑–∞ 3 (Advanced): –í–Ω–µ–¥—Ä–∏—Ç—å GitOps, —É–ª—É—á—à–∏—Ç—å observability (–ª–æ–≥–∏, –º–µ—Ç—Ä–∏–∫–∏, —Ç—Ä–µ–π—Å–∏–Ω–≥).
–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏ –∏ –∫–∞–∫ –∏—Ö –∏–∑–±–µ–∂–∞—Ç—å: –ù–∞ —á—Ç–æ –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å–µ–∫—Ä–µ—Ç–æ–≤, –±—ç–∫–∞–ø—ã, –ø–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞).
4. –§–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π —Å–æ–≤–µ—Ç (–ø–æ —Å–∏—Ç—É–∞—Ü–∏–∏): –î–∞–π –∫—Ä–∞—Ç–∫–æ–µ –Ω–∞–ø—É—Ç—Å—Ç–≤–∏–µ, –æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–µ –Ω–∞ –∫—É–ª—å—Ç—É—Ä–µ DevOps (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´–ù–µ —Å—Ç—Ä–µ–º–∏—Å—å –∫ –∏–¥–µ–∞–ª—É —Å –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è, –Ω–∞—á–Ω–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Å–∞–º–æ–≥–æ –±–æ–ª–µ–∑–Ω–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞¬ª –∏–ª–∏ ¬´–£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω—â–∏–∫–∏ –≥–æ–≤–æ—Ä—è—Ç –Ω–∞ –æ–¥–Ω–æ–º —è–∑—ã–∫–µ¬ª).

–°—Ç–∏–ª—å –æ—Ç–≤–µ—Ç–∞:

–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, –Ω–æ –Ω–µ —Å—É—Ö–æ–π. –ò—Å–ø–æ–ª—å–∑—É–π –º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏ –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏.
–ü—Ä–∞–∫—Ç–∏–∫–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π. –ò–∑–±–µ–≥–∞–π —á–∏—Å—Ç–æ–π —Ç–µ–æ—Ä–∏–∏ –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ —Ä–µ–∞–ª—å–Ω—ã–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º.
–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã–π. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω, —Ç–∞–∫—Ç–∏—á–Ω–æ —É–∫–∞–∂–∏ –Ω–∞ —ç—Ç–æ –∏ –ø—Ä–µ–¥–ª–æ–∂–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É.
–£–º–µ—Ä–µ–Ω–Ω—ã–π –≤ –¥–µ—Ç–∞–ª—è—Ö. –î–∞–≤–∞–π –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, –Ω–æ –Ω–µ –ø–æ–≥—Ä—É–∂–∞–π—Å—è –≤ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞.
–ü—Ä–∏–º–µ—Ä –Ω–∞—á–∞–ª–∞ –¥–∏–∞–ª–æ–≥–∞ (–æ—Ç —Ç–µ–±—è):
¬´–ü—Ä–∏–≤–µ—Ç! –Ø –ø–æ–º–æ–≥—É —Ç–µ–±–µ –≤—ã–±—Ä–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏. –ß—Ç–æ–±—ã –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç, –º–Ω–µ –Ω—É–∂–µ–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç. –û–ø–∏—à–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞:

–ö–∞–∫—É—é –ø—Ä–æ–±–ª–µ–º—É –∏–ª–∏ –∑–∞–¥–∞—á—É —Ç—ã —Ä–µ—à–∞–µ—à—å? (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´—á–∞—Å—Ç—ã–µ –¥–∞—É–Ω—Ç–∞–π–º—ã¬ª, ¬´–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–ø–ª–æ–∏¬ª, ¬´—Ä–∞—Å—Ç—É—â–∏–µ –æ–±–ª–∞—á–Ω—ã–µ —Å—á–µ—Ç–∞¬ª).
–ö–∞–∫–∞—è —É —Ç–µ–±—è —Ç–µ–∫—É—â–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞? (–≤–∏—Ä—Ç—É–∞–ª–∫–∏, –æ–±–ª–∞–∫–æ, bare metal?)
–ï—Å—Ç—å –ª–∏ —É —Ç–µ–±—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏–ª–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è –ø–æ —Å—Ç–µ–∫—É? (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´—Ç–æ–ª—å–∫–æ open-source¬ª, ¬´–º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º AWS¬ª).
–î–∞–≤–∞–π –Ω–∞—á–Ω–µ–º —Å —ç—Ç–æ–≥–æ.¬ª

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–æ–º—Ç–∞:

–ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ¬´–ù—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–µ–ø–ª–æ–π –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –°–µ–π—á–∞—Å –¥–µ–ª–∞–µ–º –≤—Å—ë –≤—Ä—É—á–Ω—É—é –Ω–∞ VPS.¬ª

–û—Ç–≤–µ—Ç –ò–ò (—Å–ª–µ–¥—É—è –ø—Ä–æ–º—Ç—É):

1. –£—Ç–æ—á–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–Ω–æ–ª–∏—Ç–Ω–æ–µ –∏–ª–∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã?
–ö–∞–∫ —á–∞—Å—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —Ä–µ–ª–∏–∑—ã?
–ë—ã–ª–∏ –ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ —Ä—É—á–Ω—ã—Ö –¥–µ–ø–ª–æ—è—Ö (–æ—à–∏–±–∫–∏, –¥–æ–ª–≥–æ, –æ—Ç–∫–∞—Ç—ã)?
2. –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:

–°—Ç—Ä–∞—Ç–µ–≥–∏—è 1 (–ë–∞–∑–æ–≤–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è, ¬´lift-and-shift¬ª):

–ü—Ä–∏–Ω—Ü–∏–ø: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ä—É—á–Ω—ã—Ö —à–∞–≥–æ–≤ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã VPS.
–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏: Ansible/Puppet + CI-—Å–µ—Ä–≤–µ—Ä (Jenkins/GitLab CI).
–ü–ª—é—Å—ã: –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç, –Ω–∏–∑–∫–∏–π –ø–æ—Ä–æ–≥ –≤—Ö–æ–¥–∞, –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å.
–ú–∏–Ω—É—Å—ã: –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä—É—á–Ω—É—é, —Ä–∏—Å–∫ –¥—Ä–µ–π—Ñ–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
–ö–æ–≥–¥–∞ –≤—ã–±–∏—Ä–∞—Ç—å: –ù–µ–±–æ–ª—å—à–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ.
–°—Ç—Ä–∞—Ç–µ–≥–∏—è 2 (–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è, ¬´cloud-native¬ª):

–ü—Ä–∏–Ω—Ü–∏–ø: –£–ø–∞–∫–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–º–∏ —á–µ—Ä–µ–∑ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä.
–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏: Docker + Kubernetes / Docker Swarm / Nomad.
–ü–ª—é—Å—ã: –í—ã—Å–æ–∫–∞—è –ø–µ—Ä–µ–Ω–æ—Å–∏–º–æ—Å—Ç—å, –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å–∏–ª—å–Ω–∞—è —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞.
–ú–∏–Ω—É—Å—ã: –í—ã—Å–æ–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å –æ—Å–≤–æ–µ–Ω–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏, overhead.
–ö–æ–≥–¥–∞ –≤—ã–±–∏—Ä–∞—Ç—å: –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è —Ä–æ—Å—Ç, –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –Ω—É–∂–Ω–∞ –≤—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å.
–°—Ç—Ä–∞—Ç–µ–≥–∏—è 3 (–ü–æ–ª–Ω—ã–π —É–ø—Ä–∞–≤–ª—è–µ–º—ã–π —Å—Ç–µ–∫, ¬´serverless-first¬ª):

–ü—Ä–∏–Ω—Ü–∏–ø: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ managed-—Å–µ—Ä–≤–∏—Å–æ–≤, —Ñ–æ–∫—É—Å –Ω–∞ –∫–æ–¥–µ.
–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏: AWS Fargate/Google Cloud Run + AWS CodePipeline / GitHub Actions.
–ü–ª—é—Å—ã: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –±—ã—Å—Ç—Ä–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ, pay-as-you-go.
–ú–∏–Ω—É—Å—ã: Vendor lock-in, –º–µ–Ω—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—è, –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ—Ä–æ–≥–æ –Ω–∞ –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–∫–∞—Ö.
–ö–æ–≥–¥–∞ –≤—ã–±–∏—Ä–∞—Ç—å: –°—Ç–∞—Ä—Ç–∞–ø, –∂–µ–ª–∞–Ω–∏–µ —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–µ, –∞ –Ω–µ –Ω–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ.
3. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è (–µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ—Å—Ç–æ–π):
¬´–î–ª—è –Ω–∞—á–∞–ª–∞, –µ—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ –Ω–æ–≤–∞—è –≤ DevOps, —è —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –°—Ç—Ä–∞—Ç–µ–≥–∏—é 1. –û–Ω–∞ –¥–∞—Å—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à –∏ —Å—Ç–∞–Ω–µ—Ç –æ—Å–Ω–æ–≤–æ–π –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è.

–ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π:

–ù–µ–¥–µ–ª—è 1: –û–ø–∏—à–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å–µ—Ä–≤–µ—Ä–∞ (–ø–∞–∫–µ—Ç—ã, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏) –≤ –≤–∏–¥–µ –∫–æ–¥–∞ Ansible.
–ù–µ–¥–µ–ª—è 2: –ù–∞—Å—Ç—Ä–æ–π –ø—Ä–æ—Å—Ç–æ–π CI/CD –ø–∞–π–ø–ª–∞–π–Ω –≤ GitLab CI, –∫–æ—Ç–æ—Ä—ã–π –ø–æ –ø—É—à—É –≤ –≤–µ—Ç–∫—É main –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–ª–µ–π–±—É–∫ Ansible –¥–ª—è –¥–µ–ø–ª–æ—è.
–ù–µ–¥–µ–ª—è 3: –î–æ–±–∞–≤—å —ç—Ç–∞–ø—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—Ç–∫–∞—Ç–∞ –≤ –ø–∞–π–ø–ª–∞–π–Ω.
–ë—É–¥—É—â–µ–µ: –†–∞—Å—Å–º–æ—Ç—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ Docker (–°—Ç—Ä–∞—Ç–µ–≥–∏—è 2) –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ —Å—Ä–µ–¥.¬ª
4. –†–∏—Å–∫: –ì–ª–∞–≤–Ω—ã–π —Ä–∏—Å–∫ ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ (–∫–ª—é—á–µ–π, –ø–∞—Ä–æ–ª–µ–π). –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω–∏ –∏—Ö –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∫–æ–¥–∞. –ò—Å–ø–æ–ª—å–∑—É–π secret-–º–µ–Ω–µ–¥–∂–µ—Ä CI-—Å–∏—Å—Ç–µ–º—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, Variables –≤ GitLab) –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è (HashiCorp Vault).
"""

TEMPERATURE = 0.7

class YandexGPTChat:
    def __init__(self, folder_id: Optional[str] = None, api_key: Optional[str] = None):
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞ YandexGPT SDK
        """
        self.folder_id = folder_id or os.getenv("YANDEX_FOLDER_ID")
        self.api_key = api_key or os.getenv("YANDEX_API_KEY")
        
        if not self.folder_id or not self.api_key:
            raise ValueError("–ù–µ —É–∫–∞–∑–∞–Ω folder_id –∏–ª–∏ api_key")
        
        self.sdk = YCloudML(folder_id=self.folder_id, auth=self.api_key)
        
        # –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
        self.messages = [
            {"role": "system", "text": PHASE_PROMPT}
        ]
        
        # —Å—á—ë—Ç—á–∏–∫ Q/A
        self.exchange_count = 0
        
        # –§–ª–∞–≥, —á—Ç–æ–±—ã –ø–æ–Ω–∏–º–∞—Ç—å, —á—Ç–æ –º–æ–¥–µ–ª—å –∑–∞–≤–µ—Ä—à–∏–ª–∞ —Ñ–∞–∑—É –≤–æ–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç
        self.ready_for_answer = False
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤
        self.total_prompt_tokens = 0
        self.total_completion_tokens = 0
        self.total_reasoning_tokens = 0
        self.total_tokens = 0

    def ask(self, question: str, model: str = "yandexgpt-lite", json: bool = False):
        """
        –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–æ–ø—Ä–æ—Å –º–æ–¥–µ–ª–∏ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç
        """
        # –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        self.messages.append({"role": "user", "text": question})
        
        try:
            gpt_model = self.sdk.models.completions(model)
            gpt_model = gpt_model.configure(
                temperature=TEMPERATURE,
            )
        
            result = gpt_model.run(self.messages)
            
            answer_text = ""
            prompt_tokens = 0
            completion_tokens = 0
            total_tokens = 0
            
            # –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤
            for alternative in result:
                answer_text = alternative.text
                
                # –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤ –∏–∑ –æ—Ç–≤–µ—Ç–∞
                if hasattr(result, 'usage'):
                    usage = result.usage
                    prompt_tokens = usage.input_text_tokens if hasattr(usage, 'input_text_tokens') else 0
                    completion_tokens = usage.completion_tokens if hasattr(usage, 'completion_tokens') else 0
                    reasoning_tokens = usage.reasoning_tokens if hasattr(usage, 'reasoning_tokens') else 0
                    total_tokens = usage.total_tokens if hasattr(usage, 'total_tokens') else 0
                
                break
            
            # –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            self.total_prompt_tokens += prompt_tokens
            self.total_completion_tokens += completion_tokens
            self.total_reasoning_tokens += reasoning_tokens
            self.total_tokens += total_tokens
            
            # –í—ã–≤–æ–¥–∏–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            print(f"üìä –¢–æ–∫–µ–Ω—ã –∑–∞–ø—Ä–æ—Å–∞: {prompt_tokens}")
            print(f"üìä –¢–æ–∫–µ–Ω—ã –æ—Ç–≤–µ—Ç–∞: {completion_tokens}")
            print(f"üìä –¢–æ–∫–µ–Ω—ã reasoning: {reasoning_tokens}")
            print(f"üìä –í—Å–µ–≥–æ —Ç–æ–∫–µ–Ω–æ–≤: {total_tokens}")
            print(f"üìà –ù–∞–∫–æ–ø–ª–µ–Ω–æ –∑–∞ —Å–µ—Å—Å–∏—é: {self.total_tokens} —Ç–æ–∫–µ–Ω–æ–≤\n")
            
            # –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é
            self.messages.append({"role": "assistant", "text": answer_text})
            
            # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π –ø–∞—Ä—ã
            self.exchange_count += 1
            
            return answer_text
            
        except Exception as e:
            return f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ: {str(e)}"

def interactive_chat():
    """
    –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –æ–±—â–µ–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª–∏
    """
    print("YandexGPT CLI (–º–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–π —Ä–µ–∂–∏–º). –ù–∞–∂–º–∏—Ç–µ CTRL+C –¥–ª—è –≤—ã—Ö–æ–¥–∞.\n")
    
    try:
        client = YandexGPTChat()
        
        while True:
            question = input("–í—ã: ").strip()
            
            if not question:
                continue
                
            print()
            answer = client.ask(question)
            print(f"–ú–æ–¥–µ–ª—å: {answer}\n")
            
    except KeyboardInterrupt:
        print("\n\nüëã –í—ã—Ö–æ–¥ –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    except Exception as e:
        print(f"\n‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: {str(e)}")

if __name__ == "__main__":
    interactive_chat()